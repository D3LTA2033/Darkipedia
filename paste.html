<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Create New Paste - Darkipedia</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/style.css">
    <meta name="description" content="Create and share anonymous text, stories, leaks, or images instantly on Darkipedia. No signup, no footprint.">
    <link rel="icon" href="../assets/favicon.png">
    <style>
        :root {
            --main-bg: #101617;
            --container-bg: #182124;
            --brand-green: #56fa7f;
            --brand-blue: #53f5ff;
            --brand-violet: #ff4ffe;
            --gray-border: #232726;
            --text-primary: #e7ffe9;
            --text-muted: #95b5b7;
            --header-shadow: 0 6px 32px #001f1878;
            --panel-shadow: 0 0 14px #04171c38;
            --input-bg: #172026;
            --input-focus: #1a282f;
            --input-border: #2e353a;
            --form-tip: #8ad3c4;
        }
        html, body {
            background-color: var(--main-bg);
            color: var(--text-primary);
            margin: 0;
            padding: 0;
            font-family: 'JetBrains Mono', 'Fira Mono', 'Consolas', 'Menlo', 'monospace', sans-serif;
            min-height: 100vh;
        }
        body {
            min-height: 100dvh;
            background: linear-gradient(135deg, #10413f 0%, #143345 80%) fixed;
        }
        .container {
            max-width: 470px;
            margin: 38px auto 0 auto;
            background: var(--container-bg);
            border-radius: 22px;
            box-shadow: var(--panel-shadow);
            padding: 2.0em 1.4em 1.4em 1.4em;
            min-height: 600px;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1.5px solid var(--gray-border);
            margin-bottom: 1.45em;
            padding-bottom: 0.5em;
            box-shadow: var(--header-shadow);
        }
        h1 {
            font-size: 1.54em;
            font-family: inherit;
            color: var(--brand-green);
            letter-spacing: .01em;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.14em;
        }
        .to-home-btn {
            color: var(--brand-blue);
            background: none;
            border: none;
            font-weight: 700;
            font-size: 1.09em;
            text-decoration: none;
            padding: 0.19em 0.64em 0.18em 0.58em;
            border-radius: 6px;
            transition: background 0.18s, color 0.15s;
            outline: none;
            cursor: pointer;
        }
        .to-home-btn:focus, .to-home-btn:hover {
            background: #0c2223;
            color: var(--brand-green);
        }
        .desc {
            color: var(--text-muted, #8ad3c4);
            font-size: 1.13em;
            margin-top: 0.75em;
            margin-bottom: 1.40em;
            letter-spacing: .01em;
        }
        main {
            min-height: 380px;
        }
        .paste-form-box {
            background: #171f1f;
            border-radius: 14px;
            box-shadow: 0 1px 15px #003c3c33;
            padding: 1.12em 1em 1.05em 1em;
        }
        .form-group {
            margin-bottom: 1.18em;
        }
        label {
            display: block;
            margin-bottom: .41em;
            font-size: 1.04em;
            color: var(--brand-green);
            font-weight: 500;
            letter-spacing: .01em;
        }
        .form-tip {
            margin: 0.23em 0 0.32em 0;
            font-size: 0.98em;
            color: var(--form-tip, #82d4c3);
        }
        input[type="text"], 
        textarea, 
        select {
            width: 100%;
            background: var(--input-bg);
            color: var(--text-primary);
            border: 1.2px solid var(--input-border);
            border-radius: 8px;
            padding: .7em .93em;
            font-size: 0.99em;
            margin-bottom: .13em;
            outline: none;
            box-sizing: border-box;
            font-family: inherit;
            transition: border-color 0.16s, background 0.2s;
        }
        input[type="text"]:focus, textarea:focus, select:focus {
            border-color: var(--brand-green);
            background: var(--input-focus);
        }
        select {
            padding-right: 2.7em;
            appearance: none;
        }
        .char-count {
            color: var(--brand-green);
            font-size: 0.98em;
            float: right;
            margin-top: -1.64em;
            margin-bottom: 0.88em;
            font-family: inherit;
            transition: color 0.2s;
        }
        .char-count.over {
            color: #ff4b5c !important;
        }
        textarea {
            resize: vertical;
            min-height: 120px;
        }
        input[type="file"] {
            color: #55ffe9;
            font-size: 1em;
            background: transparent;
            border: none;
            margin-bottom: 0.17em;
        }
        .image-preview-list {
            display: flex;
            gap: 0.6em;
            flex-wrap: wrap;
            margin-top: 0.4em;
        }
        .image-thumb {
            position: relative;
            display: inline-block;
            transition: box-shadow 0.18s;
        }
        .image-thumb img {
            max-width: 80px;
            max-height: 80px;
            border-radius: 7px;
            border: 1.5px solid var(--gray-border, #232726);
            box-shadow: 0 0 7px #1342484a;
            background: #162122;
        }
        .remove-image-btn {
            position: absolute;
            top: -7px; right: -7px;
            background: #ff3135;
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 22px; height: 22px;
            font-size: 1.09em;
            cursor: pointer;
            padding: 0;
            line-height: 21px;
            box-shadow: 0 1px 4px #0003;
            transition: background 0.13s;
        }
        .remove-image-btn:hover {
            background: #ff5c5b;
        }
        .btn, button[type="submit"] {
            background: linear-gradient(92deg,#53ff91 5%,#44ecc2 160%);
            color: #000;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1.14em;
            padding: 0.66em 1.47em 0.69em 1.47em;
            margin-top: .5em;
            box-shadow: 0 4px 28px #4ff66918;
            cursor: pointer;
            transition: background 0.14s, color 0.1s, box-shadow 0.17s;
            outline: none;
            font-family: inherit;
            letter-spacing: .012em;
        }
        .btn:focus, .btn:hover {
            background: linear-gradient(84deg,#53ffc7 60%,#45ff94 120%);
            color: #001;
            box-shadow: 0 6px 36px #58ffbb29;
        }
        .form-error {
            color: #ff4b5c;
            background: #251014cc;
            border-radius: 6px;
            padding: .64em .9em .64em .9em;
            font-size: 1.04em;
            margin-top: 0.54em;
            margin-bottom: 0.26em;
            display: none;
        }
        .form-success {
            color: #13fa94;
            background: #0a180e;
            border-radius: 6px;
            padding: .64em .9em .64em .9em;
            font-size: 1.04em;
            margin-top: 0.54em;
            display: none;
        }
        a, a:visited {
            color: #53f5ff;
            text-decoration: underline;
            transition: color 0.21s;
        }
        a:hover, a:focus {
            color: #56fa7f;
        }
        kbd {
            font-family: inherit;
            background: #1b2c27;
            border-radius: 4px;
            padding: 0.08em 0.38em;
            font-size: 0.97em;
            color: #60ded2;
            border: 1px solid #172427;
        }
        @media (max-width: 650px) {
            .container {
                max-width: 99vw;
                margin: 0.1em auto 0 auto;
                border-radius: 0;
                padding: 1.1em 0.7em 1.1em 0.7em;
                min-height: 95vh;
            }
            header { padding-left: 0; padding-right: 0;}
        }
        @media (max-width: 600px) {
            .image-preview-list { gap: 0.23em; }
            .image-thumb img { max-width: 54px; max-height: 54px; }
            h1 { font-size: 1.11em; }
            input[type="text"], textarea, select { font-size: 0.99em;}
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <svg width="1.8em" height="1.8em" viewBox="0 0 24 24" fill="none" style="vertical-align:middle;margin-right:.19em;">
                    <circle cx="12" cy="12" r="10" stroke="#4ff669" stroke-width="2"/>
                    <path d="M7 12.5l3 3 5-7" stroke="#4ff669" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                New Paste
            </h1>
            <a href="../index.html" class="to-home-btn" title="Go home" tabindex="0">‚Üê Home</a>
        </header>
        <main>
            <div class="desc" aria-label="About this page">
                Share code, thoughts, stories, <span style="color:#53f5ff">images</span>, or leaks anonymously, securely, and simply.
            </div>
            <div class="paste-form-box">
                <form id="paste-form" class="form" autocomplete="off" aria-label="Paste Form" novalidate>
                    <div class="form-group">
                        <label for="paste-title">Title <span class="form-tip">(optional, 100 chars max)</span></label>
                        <input
                            type="text"
                            id="paste-title"
                            name="title"
                            maxlength="100"
                            placeholder="e.g. Whistle in the Dark"
                            aria-describedby="title-limit"
                            autocomplete="off"
                        >
                        <span class="char-count" id="title-limit">0/100</span>
                    </div>
                    <div class="form-group">
                        <label for="paste-content">Content <span style="color:#ff4ffe;" title="Required">*</span></label>
                        <textarea
                            id="paste-content"
                            name="content"
                            rows="14"
                            minlength="5"
                            required
                            maxlength="25000"
                            placeholder="Write or paste your content here..."
                            aria-describedby="content-limit"
                            spellcheck="true"
                        ></textarea>
                        <span class="char-count" id="content-limit">0/25000</span>
                        <div class="form-tip">
                            üí° ProTip: Paste code, text, or URL ‚Äî Auto-saves for 30 minutes if you reload.
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="paste-images">
                            Attach Images
                            <span class="form-tip">(jpg, png, gif &ndash; max 5, 2MB each)</span>
                        </label>
                        <input
                            type="file"
                            id="paste-images"
                            name="images"
                            accept=".jpg,.jpeg,.png,.gif,image/jpeg,image/png,image/gif"
                            multiple
                            aria-describedby="img-tip"
                        >
                        <div id="img-tip" class="form-tip">
                            Hold <kbd>Ctrl</kbd>/<kbd>Cmd</kbd> to select multiple.
                            <span style="color:#ffc400">No EXIF is kept.</span>
                        </div>
                        <div class="image-preview-list" id="image-preview-list" aria-live="polite"></div>
                    </div>
                    <div class="form-group">
                        <label for="paste-category">Category <span style="color:#ff4ffe;">*</span></label>
                        <select id="paste-category" name="category" required aria-describedby="cat-tip">
                            <option value="" disabled selected>Select a category</option>
                            <option value="Tech">Tech</option>
                            <option value="Leaks">Leaks</option>
                            <option value="Stories">Stories</option>
                            <option value="Knowledge">Knowledge</option>
                            <option value="Misc">Misc</option>
                        </select>
                        <div id="cat-tip" class="form-tip">Please pick the most relevant tag.</div>
                    </div>
                    <button type="submit" id="publish-btn" class="btn" aria-label="Publish Paste">üöÄ Publish</button>
                    <div class="form-error" style="display:none;" tabindex="-1" aria-live="assertive"></div>
                    <div class="form-success" style="display:none;" tabindex="-1" aria-live="polite"></div>
                </form>
                <div class="form-tip" style="margin-top:1.3em;">
                    <b>Privacy-First:</b> Pastes are <u>unlisted</u>, not indexed, and auto-expire in 60 days.
                    <a href="../pages/faq.html" style="color:#46ff6e;" tabindex="0">Learn more</a>
                </div>
            </div>
        </main>
    </div>
    <script>
        // Check captcha first
        const verified = sessionStorage.getItem('captcha_verified');
        const verifyTime = sessionStorage.getItem('captcha_time');
        if (verified !== 'true' || !verifyTime || (Date.now() - parseInt(verifyTime)) > 3600000) {
            window.location.href = '../loading.html';
        }
        
        // Character counter for title and content
        function updateCounter(id, max) {
            const input = document.getElementById(id);
            const counter = document.getElementById(id + "-limit");
            if (!input || !counter) return;
            let val = input.value || "";
            counter.textContent = val.length + "/" + max;
            counter.classList.toggle('over', val.length > max);
        }
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('paste-title').addEventListener('input', function() {
                updateCounter('paste-title', 100);
            });
            document.getElementById('paste-content').addEventListener('input', function() {
                updateCounter('paste-content', 25000);
            });
            updateCounter('paste-title', 100);
            updateCounter('paste-content', 25000);

            // Image preview with removal and accessibility improvements
            const imgInput = document.getElementById('paste-images');
            const previewList = document.getElementById('image-preview-list');
            let filesArr = [];

            imgInput.addEventListener('change', function(e) {
                let files = Array.from(e.target.files).slice(0, 5); // only 5 files max
                // Copy to persistent array for reliable removal
                filesArr = files.filter(
                  file => file.type.match(/^image\/(jpeg|png|gif)$/) && file.size <= 2 * 1024 * 1024
                );
                drawPreviews();
            });

            function drawPreviews() {
                previewList.innerHTML = '';
                filesArr.forEach((file, idx) => {
                    const reader = new FileReader();
                    reader.onload = function(ev) {
                        let thumb = document.createElement('div');
                        thumb.className = 'image-thumb';
                        thumb.innerHTML = `<img src="${ev.target.result}" alt="Upload Preview ${file.name}">
                            <button type="button" title="Remove image ${file.name}" class="remove-image-btn" tabindex="0">&times;</button>`;
                        thumb.querySelector('.remove-image-btn').onclick = function() {
                            filesArr.splice(idx, 1);
                            const dt = new DataTransfer();
                            filesArr.forEach(f => dt.items.add(f));
                            imgInput.files = dt.files;
                            drawPreviews();
                        };
                        previewList.appendChild(thumb);
                    };
                    reader.readAsDataURL(file);
                });
            }

            // Accessibility: focus error on form error
            document.getElementById('paste-form').addEventListener('submit', function() {
                setTimeout(() => {
                    const err = document.querySelector('.form-error[style*="block"]');
                    if (err) err.focus();
                }, 50);
            });
        });
    </script>
    <script src="../js/paste.js"></script>
</body>
</html>
